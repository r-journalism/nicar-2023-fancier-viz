{
  "hash": "95226f49581ebe2000603f0b4715454f",
  "result": {
    "markdown": "---\ntitle: \"gganimate\"\nformat: html\neditor: visual\n---\n\n\nAnimated viz is great at engaging people, especially on social media.\n\nYou can follow along with the `gganimate.qmd` file in the **nicar-2023-fancier-viz** project folder that you downloaded in the First steps link.\n\nIf you've downloaded the appropriate data files and put them in a data folder, you can just copy and paste all the code in the gray boxes in an R script.\n\nWe're going to try a package called [**gganimate**](https://gganimate.com/)**.**\n\nLet's load the libraries, import the state-level data and see the structure of the data we've imported.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gganimate)\n\nstate_df <- read_csv(\"data/opioids_states.csv\")\n\nstate_df_wide <-  state_df %>% \n  pivot_wider(names_from=\"type\", values_from=\"rate\")\n\nglimpse(state_df_wide)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 459\nColumns: 12\n$ buyer_state      <chr> \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\",…\n$ year             <dbl> 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014,…\n$ pills            <dbl> 15667010, 17272433, 18707811, 20160949, 21012703, 224…\n$ state            <chr> \"Alaska\", \"Alaska\", \"Alaska\", \"Alaska\", \"Alaska\", \"Al…\n$ deaths           <dbl> 29, 15, 88, 90, 62, 66, 81, 69, 76, 124, 165, 185, 20…\n$ population       <dbl> 675302, 680300, 687455, 698895, 710231, 722718, 73144…\n$ crude_rate       <chr> \"4.3\", \"Unreliable\", \"12.8\", \"12.9\", \"8.7\", \"9.1\", \"1…\n$ state_code       <chr> \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\",…\n$ region           <chr> \"West\", \"West\", \"West\", \"West\", \"West\", \"West\", \"West…\n$ division         <chr> \"Pacific\", \"Pacific\", \"Pacific\", \"Pacific\", \"Pacific\"…\n$ death_per_1m     <dbl> 42.9, 22.0, 128.0, 128.8, 87.3, 91.3, 110.7, 93.9, 10…\n$ pills_per_person <dbl> 23.2, 25.4, 27.2, 28.8, 29.6, 31.1, 31.1, 30.1, 29.9,…\n```\n:::\n:::\n\n\nOkay, let's make a nicer version of the scatterplot we created in `ggrepel.qmd`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Let's save the ggplot steps into the object: p\np <- ggplot(\n  state_df_wide,\n  aes(x=death_per_1m, y=pills_per_person, \n      size=population, color=region)\n  ) +\n  geom_point(\n    alpha = 0.7#,\n    #show.legend = FALSE\n  ) +\n  labs(\n    x = \"Deaths per 1 million residents\",\n    y = \"Pills per person\"\n  ) +\n  theme_minimal()\np\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### How to use gganimate\n\nYou basically need a ggplot2 viz and then think about these 3 things\n\n-   **transitions:** Data should change\n\n-   **views:** Does the viewpoint need to change\n\n-   **shadows:** Should the viz have memory\n\nLet's add the function `transition_time()` and use the variable **year**.\n\nWe're starting out with the ggplot2 code we saved to the object `p` and building onto it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanim <- p +\n  transition_time(year)\n\nanim\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-3-1.gif)\n:::\n:::\n\n\nThat's pretty damn cool!\n\nAnd so simple! All that from one function!\n\n(Okay, not so simple, we had to structure the data correctly)\n\nBut let's add some labels so we know what the timeline is.\n\nWe're going to add `labs()` with a special `{frame_time}` argument.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanim <- p +\n  transition_time(year) +\n  labs(title = 'Year: {frame_time}')\n\nanim\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-4-1.gif)\n:::\n:::\n\n\nOof, it's a little exacting with the frame time.\n\nWe can wrap up the **year** variable with a `as.integer()` function to fix it.\n\nAlso, let's add a `shadow_wake()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanim <- p +\n  transition_time(as.integer(year)) +\n  labs(title = 'Year: {frame_time}') +\n  shadow_wake(wake_length = 0.1,\n              alpha = FALSE)\n\nanim\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-5-1.gif)\n:::\n:::\n\n\nMuch better!\n\nOkay, let's try one other `shadow_mark()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanim <- p +\n  transition_time(as.integer(year)) +\n  labs(title = 'Year: {frame_time}') +\n  shadow_mark(alpha = 0.3,\n              size = 0.5)\n\nanim\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-6-1.gif)\n:::\n:::\n\n\nHm, not a big fan of that one. Oh well.\n\nOkay, one more chart!\n\nLet's slice out Tennesee from the data and make a line chart like we did in the `geofacet.qmd` file.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- state_df %>% \n  filter(state==\"Tennessee\") %>% \n  ggplot(aes(x=year, y=rate, color=type)) +\n  geom_line() +\n  theme_minimal() +\n  theme(legend.position = 'bottom') +\n  labs(title=\"Rates of opioid purchases and deaths in Tennessee\",\n       x = \"Year\",\n       y = \"Rate\")\n\np\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nBut! Let's make it animated!\n\nThis time, we'll use the `transition_reveal()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np +\n  transition_reveal(year)\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-8-1.gif)\n:::\n:::\n\n\nBeautiful!\n\nBut how about some points to highlight the years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np +\n  transition_reveal(year) +\n  geom_point(aes(\n    x = year, y=rate,\n    color = type\n  ))\n```\n\n::: {.cell-output-display}\n![](gganimate_files/figure-html/unnamed-chunk-9-1.gif)\n:::\n:::\n\n\nVery cool. This is a really interesting way to add one more time variable to your visualization.\n\nGreat job. If you want to save it as a gif, you can do so through RStudio's plots panel or with the function `[anim_save(https://gganimate.com/reference/index.html)]`\n\nBe sure to check out [gganimate.com](https://gganimate.com/) for more documentation on animating other viz.\n\nLet's go back to visualizing relationships geographically, this time with a **[bivariate](bivariate_map.html)** map.\n",
    "supporting": [
      "gganimate_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}